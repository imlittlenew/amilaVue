<!DOCTYPE html>
<html lang="en">

<head>
  <link href="img/logo.png" rel="shortcut icon" />
  <title>AMILA</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/aos.css" rel="stylesheet">
  <link href="css/login-signup.css" rel="stylesheet">
  <link href="css/mycss.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js/NavigationBar.js"></script>
  <script src="js/aos.js"></script>
  <script src="js/myjs.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>

</head>

<body>
  <div id="app" >

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" >
          <div class="toast-body d-flex justify-content-between align-items-center my-2">
              <h5 class="my-2 ms-3 fw-bolder">{{ toastMessage }}</h5>
              <button type="button" class="btn-close mx-3" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
      </div>
  </div>

    <button @click="scrollToTop" id="backToTopBtn" title="回到頂部"></button>
    <!-- 優惠訊息 -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary p-2" data-bs-theme="dark">
      <div class="container text-center">
        <div class="row mx-auto">
          <div class="col-12 ">
            <span class="navbar-brand mb-0 fs-6 text-light"><b>{{PromotionalMessage}}</b></span>
  
          </div>
        </div>
        <!-- Content here -->
      </div>
    </nav>
    <!-- 導覽列 -->
    <div id="navigation"></div>

    <success-alert v-if="successMessage" :message="successMessage"></success-alert>

  <div class="row mb-5">
    <div class="col-md-6 order-2 order-md-1">
      <h1 class="text-center mt-5"><b>會員專區</b></h1>
      
      <!-- 登入表單開始 -->
      <main class="form-signin w-100 m-auto" id="loginForm" v-show="loginFormVisible">
        <form id="loginFormElement" @submit.prevent="submitLoginForm">
          <h1 class="h3 mb-3 fw-normal text-center">登入</h1>
          <div class="form-floating">
            <input type="email" class="form-control" id="loginEmail" placeholder="name@example.com" autocomplete="username" required>
            <label for="loginEmail">Email address</label>
          </div>
          <div class="form-floating">
            <input type="password" class="form-control" id="loginPassword" placeholder="Password" minlength="8" autocomplete="current-password" required>
            <label for="loginPassword">Password</label>
          </div>

          <div class="form-check text-start my-3 d-flex justify-content-between">
            <label class="form-check-label" for="loginFlexCheckDefault">
              <input class="form-check-input me-2" type="checkbox" value="remember-me" id="loginFlexCheckDefault">
              <span>記住帳號</span>
            </label>
            <button type="button" @click="toggleForm('forgotPasswordForm')" class="text-end align-self-center dark-link"  id="toggleforgot">忘記密碼?</button>
          </div>

          <button @click="submitLoginForm()" class="btn btn-dark w-100 py-2 rounded-pill" type="submit">登入</button>
          <p class="mt-5 mb-3 text-body-secondary text-center">沒有 AMILA 帳戶?<button @click="toggleForm('registerForm')" id="toggleRegister"
              class="dark-link">免費註冊!</button></p>
        </form>
      </main>
      <!-- 登入表單結束 -->
      <!-- 註冊表單開始 -->
      <main class="form-signin w-100 m-auto" id="registerForm" v-show="registerFormVisible">
        <form id="registerFormElement" @submit.prevent="submitRegisterForm">
          <h1 class="h3 mb-3 fw-normal text-center">註冊</h1>

          <div class="form-floating">
            <input type="email" class="form-control" id="registerEmail" placeholder="name@example.com" autocomplete="username" required>
            <label for="floatingInput">Email address</label>
          </div>
          <div class="form-floating">
            <input type="password" class="form-control" id="registerPassword" placeholder="Password" minlength="8" autocomplete="current-password"
              required>
            <label for="floatingPassword">Password</label>
          </div>

          <div class="form-check text-start my-3">
            <input class="form-check-input" type="checkbox" value="remember-me" id="registerFlexCheckDefault">
            <label class="form-check-label" for="registerFlexCheckDefault">
              我想接收有關產品和促銷活動的最新資訊。
            </label>
          </div>
          <button @click="submitRegisterForm()" class="btn btn-dark w-100 py-2 rounded-pill" type="submit">建立帳戶</button>
          <p class="mt-5 mb-3 text-body-secondary text-center">已經有帳戶?<button @click="toggleForm('loginForm')" id="toggleLogin"
              class="dark-link">登入</button></p>
        </form>
      </main>
      <!-- 註冊表單結束 -->
      <!-- 忘記密碼開始  -->
      <main class="form-signin w-100 m-auto" id="forgotPasswordForm" v-show="forgotPasswordFormVisible">
        <form @submit.prevent="submitforgotPasswordForm">
          <h1 class="h3 mb-3 fw-normal text-center mb-5">忘記密碼?</h1>
          <div class="form-floating">

            <input type="email" class="form-control" id="forgotPasswordEmail" placeholder="請輸入使用者名稱或電子郵件地址" required @keyup.enter="submitForgotPasswordForm">
            <label for="forgotPasswordForm">請輸入電子郵件地址</label>
          </div>
          <button @click="submitForgotPasswordForm()" class="btn btn-dark w-100 py-2 mt-5 rounded-pill" type="submit">重新設定密碼</button>
        </form>
      </main>
      <!-- 忘記密碼結束 -->
    </div>
    <div class="col-md-6 order-1 order-md-2">
      <div ><img src="img/login-signup.png" class="bg-img"></a></div>
    </div>
  </div>
   <!-- 我的頁尾開始 -->
  <template>
    <Footer>
      <div class="b-example-divider"></div>
      <div class="mt-5 p-4 text-white text-center " style="background-image: url('img/footer.png');" data-bs-theme="dark">
        <div class="container  mt-5">
          <footer class="py-5 mt-5">
            <div class="row  mt-5 ">
              <div class="col-6  mb-3">
                <ul class="nav flex-column">
                  <li class="nav-item mb-2 text-start">
                    <h5><b>聯絡我們</b></h5>
                  </li>
                  <br>
                  <li class="nav-item mb-2 text-start">
                    <h6>營業時間｜{{ businessHours }}</h6>
                  </li>
                  <li class="nav-item mb-2 text-start">
                    <h6>地址｜{{ address }}</h6>
                  </li>
                  <li class="nav-item mb-2 text-start">
                    <h6>客服信箱｜{{ email }}</h6>
                  </li>
                  <li class="nav-item mb-2 text-start">
                    <h6>客服電話｜{{ phone }}</h6>
                  </li>
                </ul>
              </div>
              <div class="col-md-6 ">
                <form>
                  <div class="text-start">
                    <h5><b>訂閱電子報</b></h5>
                  </div>
                  <div class="input-group mb-3">
                    <label for="newsletter1" class="visually-hidden">訂閱電子報信箱</label>
                    <input type="text" class="form-control rounded-start" placeholder="訂閱電子報信箱"
                      aria-label="Recipient's username" aria-describedby="button-addon2">
                    <button class="btn btn-outline-light " type="button" id="button-addon2">訂閱</button>
                  </div>
                  <div>
                    <ul class="list-unstyled d-flex">
                      <li class="ms-0"><img src="img/JCB.png" class="img-fluid img-thumbnail" alt="..."></a></li>
                      <li class="ms-0"><img src="img/VISA.png" class="img-fluid img-thumbnail" alt="..."></a></li>
                      <li class="ms-0"><img src="img/MasterCard.png" class="img-fluid img-thumbnail" alt="..."></a></li>
                    </ul>
                  </div>
                </form>
              </div>
            </div>
            <div class="d-flex flex-column flex-sm-row justify-content-between py-4 my-4 border-top">
              <p>&copy; {{ currentYear }} 阿米拉工作室股份有限公司</p>
            </div>
          </footer>
        </div>
      </div>
    </Footer>
  </template>
    <!-- 我的頁尾結束 -->
  </div>

  <script>
  Vue.component('success-alert', {
    props: ['message'],
    template: `
      <div id="SuccessAlert" class="d-flex align-items-center">
        {{ message }}
        <div class="spinner-grow spinner-grow-sm mx-2" role="status">
          <div class="visually-hidden">Loading...</div>
        </div>
        <div class="spinner-grow spinner-grow-sm me-2" role="status">
          <div class="visually-hidden">Loading...</div>
        </div>
        <div class="spinner-grow spinner-grow-sm" role="status">
          <div class="visually-hidden">Loading...</div>
        </div>
      </div>
    `
  });
    // 建立 Vue 實例並設置選項
    new Vue({
      el: '#app', // 指定 Vue 實例控制的元素
      data() {
        return {
          PromotionalMessage: '歡慶阿米拉品牌月！全館 $599 享免運！', // 定義數據
          businessHours: "周一至周五 09：00 - 16：30",
          address: "臺中市南屯區公益路二段51號(國泰公益大樓)",
          email: "amila@gmail.com",
          phone: "(04)2242-1717 #263",
          currentYear: new Date().getFullYear(),
          loginFormVisible: true, // 控制登入表單的顯示狀態
          registerFormVisible: false, // 控制註冊表單的顯示狀態
          forgotPasswordFormVisible: false, // 控制忘記密碼表單的顯示狀態
          successMessage: '', // 定義 successMessage
          email: '',
          password: '',
          toastMessage: '',
            };
          },
      
      mounted() {
        // 選擇所有具有 "hover" 類別的元素，並為它們添加滑鼠離開事件監聽器
        document.querySelectorAll(".hover").forEach(element => {
          element.addEventListener('mouseleave', () => {
            element.classList.remove("hover");
          });
        });

    
      },

      methods: {
        loginSuccess() {
          localStorage.setItem('isLoggedIn', true);
        },
        showToast(message) {
            // 设置吐司消息内容
            this.toastMessage = message;
            // 显示吐司消息
            $('#liveToast').toast('show');
        },
        toggleForm(form) {
        // 根據傳入的表單名稱來切換表單的可見性
        switch (form) {
          case 'loginForm':
            this.loginFormVisible = true;
            this.registerFormVisible = false;
            this.forgotPasswordFormVisible = false;
            break;
          case 'registerForm':
            this.loginFormVisible = false;
            this.registerFormVisible = true;
            this.forgotPasswordFormVisible = false;
            break;
          case 'forgotPasswordForm':
            this.loginFormVisible = false;
            this.registerFormVisible = false;
            this.forgotPasswordFormVisible = true;
            break;
          default:
            // 如果表單名稱無效，不做任何操作
            break;
        }
      },
      handleSuccess(type) {
      switch (type) {
        case 'login':
          this.successMessage = '登入成功';
          break;
        case 'register':
          this.successMessage = '註冊成功';
          break;
        case 'forgotPassword':
          this.successMessage = '發送郵件成功';
          break;
        default:
          this.successMessage = '';
      }

      // 三秒后清除 successMessage，并执行页面跳转
      setTimeout(() => {
        this.successMessage = '';
        // 根据 type 进行不同的页面跳转
        switch (type) {
          case 'login':
            // 跳转到登录成功页面
            window.location.href = 'index.html';
            break;
          case 'register':
            // 跳转到注册成功页面
            window.location.href = 'user.html';
            break;
          case 'forgotPassword':
            // 跳转到忘记密码成功页面
            window.location.href = 'user.html';
            break;
          default:
            // 默认情况下不进行跳转
            break;
        }
      }, 1500);
    },


        handleScroll() {
          // 滾動事件處理程序
          let prevScrollpos = window.pageYOffset; // 儲存先前的捲動位置
          let backToTopBtn = document.getElementById("backToTopBtn"); // 獲取回到頂部按鈕元素
  
          window.addEventListener("scroll", () => {
            // 監聽滾動事件
            let currentScrollPos = window.pageYOffset; // 當前捲動位置
  
            if ((currentScrollPos > 100 && currentScrollPos !== 0) && prevScrollpos > currentScrollPos) {
              // 判斷是否顯示回到頂部按鈕
              backToTopBtn.style.opacity = "1"; // 顯示按鈕
            } else {
              backToTopBtn.style.opacity = "0"; // 隱藏按鈕
            }
  
            prevScrollpos = currentScrollPos; // 更新先前捲動位置
          });
  
          backToTopBtn.addEventListener("click", () => {
            // 監聽回到頂部按鈕的點擊事件
            this.scrollToTop(); // 呼叫 scrollToTop 方法，實現滾動到頂部的功能
          });
        },
        scrollToTop() {
          // 捲動到頂部的方法
          window.scrollTo({
            top: 0,
            behavior: "smooth" // 使用平滑滾動效果
          });
        },
      
      // 提交忘記密碼表單
      submitForgotPasswordForm() {
        const email = $('#forgotPasswordEmail').val();
        if (email !== '') {
          if (this.isValidEmail(email)) {
            // 發送請求到後端
            fetch('http://localhost:8000/forgot-password', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ email: email })
            })
            .then(response => {
              if (response.ok) {
                // 請求成功
                const forgotPassword = 'forgotPassword';
                this.handleSuccess(forgotPassword);
              } else {
                // 請求失敗
                response.text().then(errorMessage => {
                  this.showToast(errorMessage);
                });
              }
            })
            .catch(error => {
              console.error('發送請求失敗', error);
              this.showToast('發生錯誤，請稍後再試！');
            });
          } else {
            this.showToast('電子郵件格式不正確！');
          }
        } else {
          this.showToast('電子郵件不能為空！');
        }
      },

        // 提交註冊表單
        submitRegisterForm() {
        const email = $('#registerEmail').val();
        const password = $('#registerPassword').val();
        // 檢查郵箱格式是否正確
        if (email !== '') {
          if (this.isValidEmail(email)) {
            // 檢查密碼是否為空
            if (password !== '') {
              // 檢查密碼格式是否正確
              if (this.isValidPassword(password)) {
                // 發送 POST 請求到後端的 /register 路由
                fetch('http://localhost:8000/register', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ email, password }) // 將郵箱和密碼作為請求的內容
                })
                .then(response => {
                  if (response.ok) {
                    // 如果請求成功，則顯示成功訊息
                    this.handleSuccess('register');
                  } else {
                    // 如果請求失敗，則顯示錯誤訊息
                    this.showToast('會員已存在');
                  }
                })
                .catch(error => {
                  this.showToast('註冊失敗');
                });
              } else {
                // 密碼格式不正確，顯示吐司訊息
                this.showToast('密碼至少八位，包含一個大寫字母和一個小寫字母！');
              }
            } else {
              // 密碼為空，顯示吐司訊息
              this.showToast('密碼不能為空！');
            }
          } else {
            // 郵箱格式不正確，顯示吐司訊息
            this.showToast('電子郵件格式不正確！');
          }
        } else {
          // 郵箱為空，顯示吐司訊息
          this.showToast('電子郵件不能為空！');
        }
      },

      // 提交登入表單
        submitLoginForm() {
        const email = $('#loginEmail').val();
        const password = $('#loginPassword').val();
        // 檢查郵箱格式是否正確
        if (email !== '') {
          if (this.isValidEmail(email)) {
            // 檢查密碼是否為空
            if (password !== '') {
              // 檢查密碼格式是否正確
              if (this.isValidPassword(password)) {
                // 發送 POST 請求到後端的 /register 路由
                fetch('http://localhost:8000/login', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ email, password }) // 將郵箱和密碼作為請求的內容
                })
                .then(response => {
                  if (response.ok) {
                    // 如果請求成功，則顯示成功訊息
                    this.handleSuccess('login');
                    this.loginSuccess();
                  } else {
                    // 如果請求失敗，則顯示錯誤訊息
                    this.showToast('帳號或密碼錯誤');
                  }
                })
                .catch(error => {
                  this.showToast('帳號或密碼錯誤');
                });
              } else {
                // 密碼格式不正確，顯示吐司訊息
                this.showToast('密碼至少八位，包含一個大寫字母和一個小寫字母！');
              }
            } else {
              // 密碼為空，顯示吐司訊息
              this.showToast('密碼不能為空！');
            }
          } else {
            // 郵箱格式不正確，顯示吐司訊息
            this.showToast('電子郵件格式不正確！');
          }
        } else {
          // 郵箱為空，顯示吐司訊息
          this.showToast('電子郵件不能為空！');
        }
      },



        // 驗證郵件地址
        isValidEmail(email) {
          const emailPattern = /\S+@\S+\.\S+/;
          return emailPattern.test(email);
        },
        isValidPassword(password) {
        // 密码至少八位，包含一个大写字母、一个小写字母
        const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
        return passwordPattern.test(password);
        }
          }  
        });
  </script>
  <script>
    // 獲取 Vue 組件的容器元素
    const navigationElement = document.getElementById('navigation');
  
    // 創建 Vue 實例並掛載到容器元素上
    new Vue({
      render: h => h(NavigationBar)
    }).$mount(navigationElement);
  </script>
</body>

</html>